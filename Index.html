<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mestre das Escalas Musicais</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
/* --- estilo simplificado para manter foco --- */
body { background-color:#f8f9fa; }
.titulo-3d { font-weight:900; font-size:2rem; color:#fff; background:linear-gradient(180deg,#4b6cb7 0%,#182848 100%); text-shadow:0 1px 0 rgba(255,255,255,0.05),0 2px 0 rgba(0,0,0,0.25),0 4px 8px rgba(0,0,0,0.45); padding:0.25rem 0.8rem; border-radius:10px; display:inline-block; transform: perspective(600px) rotateX(6deg);}
.nota-teclado { width:60px;height:60px;margin:4px;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:1.1em;cursor:pointer;flex:1 1 60px;}
.nota-teclado.sustenido { background-color:black !important;color:white !important; }
.nota-escala { width:70px;height:70px;margin:5px;border:2px solid #343a40;background-color:#e9ecef;display:flex;align-items:center;justify-content:center;font-size:1.2em;font-weight:bold;border-radius:8px;}
.nota-preenchida { background-color:#28a745 !important;color:white;border-color:#1e7e34; }
.nota-errada { animation: shake 0.5s; background-color:#dc3545 !important;color:white;}
@keyframes shake {0%,100%{transform:translate(0);}20%{transform:translate(-2px,0);}40%{transform:translate(2px,0);}60%{transform:translate(-2px,0);}80%{transform:translate(2px,0);}}
.intervalos-container{display:flex;justify-content:center;margin-top:8px;gap:10px;flex-wrap:wrap;}
.intervalo-box{font-size:0.9rem;font-weight:bold;color:#444;}
</style>
</head>
<body>

<div class="container mt-4 mb-5">
<h1 class="text-center mb-4"><span class="titulo-3d">Mestre das Escalas</span></h1>

<div id="modo-selecao" class="text-center mb-4">
<h3 class="mb-3">Escolha o Modo:</h3>
<div class="d-flex justify-content-center flex-wrap">
<button class="btn btn-primary btn-lg m-2" onclick="iniciarJogo('major')">Escalas Maiores</button>
<button class="btn btn-warning btn-lg m-2" onclick="iniciarJogo('minorNatural')">Menor Natural</button>
<button class="btn btn-warning btn-lg m-2" onclick="iniciarJogo('minorHarmonic')">Menor Harm√¥nica</button>
<button class="btn btn-warning btn-lg m-2" onclick="iniciarJogo('minorMelodic')">Menor Mel√≥dica</button>
</div>
</div>

<div id="area-jogo" class="d-none">

<div class="d-flex justify-content-between align-items-center mb-3">
<div class="text-center mb-3">
    <button class="btn btn-secondary btn-lg m-2" id="btn-voltar-inicio" onclick="voltarTelaInicial()">‚Üê Voltar √† Tela Inicial</button>
</div>
<h3 id="desafio-titulo" class="text-center flex-grow-1 my-2"></h3>
<span class="badge bg-dark fs-6">Desafio <span id="contador-desafios">1</span> de 10</span>
</div>
<div id="escala-container" class="d-flex justify-content-center flex-column align-items-center mb-3"></div>
<div class="alert alert-info text-center" id="feedback-mensagem" role="alert">Clique nas notas abaixo para construir a escala.</div>
<div id="teclado-container" class="d-flex justify-content-center flex-wrap mb-3"></div>
<div class="text-center mb-3">
<button class="btn btn-primary btn-lg d-none m-2" id="botao-tocar-escala" onclick="tocarEscalaCompleta()">üé∂ Tocar Escala</button>
<button class="btn btn-success btn-lg d-none m-2" id="botao-proximo" onclick="proximoDesafio()">Pr√≥xima Escala</button>
</div>
<!-- Gr√°fico por nota -->
<canvas id="grafico-notas" width="400" height="150" class="mb-4"></canvas>
<!-- Gr√°fico acumulado -->
<canvas id="grafico-acumulado" width="400" height="150" class="mb-4"></canvas>
</div>

<div id="area-relatorio" class="mt-4 p-4 border rounded shadow-sm d-none">
<h2 class="text-center text-success mb-4">Relat√≥rio Final do Desafio</h2>
<div id="relatorio-detalhes" class="fs-5 text-center"></div>
<div class="text-center mt-4"><button class="btn btn-primary btn-lg" onclick="location.reload()">Recome√ßar o Jogo</button></div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/tone@14.7.58/build/Tone.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
// --- Dados ---
const notasCromaticas=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];
const padraoEscala={
    major:{nome:"Maior",intervalos:[0,2,4,5,7,9,11,12]},
    minorNatural:{nome:"Menor Natural",intervalos:[0,2,3,5,7,8,10,12]},
    minorHarmonic:{nome:"Menor Harm√¥nica",intervalos:[0,2,3,5,7,8,11,12]},
    minorMelodic:{nome:"Menor Mel√≥dica",intervalos:[0,2,3,5,7,9,11,12]}
};
const intervalosDescricao=["Tom","Tom","Semitom","Tom","Tom","Tom","Semitom"];
const MAX_DESAFIOS=10;

let modoAtual='major', escalaCorreta=[], notaAtualIndex=0, desafiosCompletados=0, totalErros=0, jogoFinalizado=false, synth;
let errosPorNota = Array(8).fill(0);
let acertosAcumulados = Array(8).fill(0);

// ---‚ÄúVoltar √† Tela Inicial‚Äù ---
function voltarTelaInicial() {
    // Oculta √°reas do jogo e relat√≥rio
    document.getElementById('area-jogo').classList.add('d-none');
    document.getElementById('area-relatorio').classList.add('d-none');
    // Reseta vari√°veis do jogo
    notaAtualIndex = 0;
    desafiosCompletados = 0;
    totalErros = 0;
    jogoFinalizado = false;
    errosPorNota.fill(0);
    acertosAcumulados.fill(0);
    // Atualiza gr√°ficos zerados
    atualizarGraficoNotas();
    atualizarGraficoAcumulado();
    // Mostra modo de sele√ß√£o
    document.getElementById('modo-selecao').classList.remove('d-none');
    atualizarFeedback(`Selecione um modo de escala para come√ßar.`);
}

// --- Audio ---
function inicializarAudio(){if(!synth){synth=new Tone.PolySynth(Tone.Synth,{oscillator:{type:"sawtooth"},envelope:{attack:0.005,decay:0.1,sustain:0.3,release:1}}).toDestination();Tone.start();}}
function tocarNota(nota){if(synth)synth.triggerAttackRelease(nota+"4","0.4s");}
function tocarEscalaCompleta(){if(!synth||!Array.isArray(escalaCorreta))return;Tone.Transport.cancel();escalaCorreta.forEach((nota,i)=>Tone.Transport.scheduleOnce(time=>synth.triggerAttackRelease(nota+"4","0.4",time),i*0.5));Tone.Transport.start();setTimeout(()=>Tone.Transport.stop(),escalaCorreta.length*500);}

// --- Interface ---
function renderizarTeclado(){const div=document.getElementById('teclado-container');div.innerHTML='';notasCromaticas.forEach(nota=>{const btn=document.createElement('button');btn.className='btn nota-teclado';btn.classList.add(nota.includes("#")?"sustenido":"btn-secondary");btn.textContent=nota;btn.addEventListener('click',()=>checarNota(nota));div.appendChild(btn);});}
function renderizarEscalaContainer(){const div=document.getElementById('escala-container');div.innerHTML='';const linha=document.createElement('div');linha.className="d-flex justify-content-center flex-wrap";for(let i=0;i<8;i++){const box=document.createElement('div');box.className='nota-escala';box.id=`nota-box-${i}`;box.textContent=i===0?escalaCorreta[0]:'?';if(i===0)box.classList.add('nota-preenchida');linha.appendChild(box);}div.appendChild(linha);const linhaIntervalos=document.createElement('div');linhaIntervalos.className='intervalos-container';intervalosDescricao.forEach(intv=>{const box=document.createElement('div');box.className='intervalo-box';box.textContent=intv;linhaIntervalos.appendChild(box);});div.appendChild(linhaIntervalos);}
function atualizarFeedback(msg,tipo='info'){const f=document.getElementById('feedback-mensagem');f.className=`alert alert-${tipo} text-center`;f.innerHTML=msg;}

// --- L√≥gica do Jogo ---
function gerarEscalaCorreta(tonicaIndex,modo){const intv=padraoEscala[modo].intervalos;return intv.map(i=>notasCromaticas[(tonicaIndex+i)%12]);}
function iniciarJogo(modo){modoAtual=modo;inicializarAudio();document.getElementById('modo-selecao').classList.add('d-none');document.getElementById('area-jogo').classList.remove('d-none');renderizarTeclado();gerarDesafio();}
function gerarDesafio(){escalaCorreta=gerarEscalaCorreta(Math.floor(Math.random()*12),modoAtual);notaAtualIndex=1;document.getElementById('desafio-titulo').textContent=`Monte a Escala de ${escalaCorreta[0]} ${padraoEscala[modoAtual].nome}`;document.getElementById('botao-proximo').classList.add('d-none');document.getElementById('botao-tocar-escala').classList.add('d-none');document.querySelectorAll('.nota-teclado').forEach(btn=>btn.removeAttribute('disabled'));renderizarEscalaContainer();atualizarFeedback(`Escolha a ${notaAtualIndex+1}¬™ nota. Erros acumulados: ${totalErros}`);errosPorNota.fill(0);}
function checarNota(nota){if(notaAtualIndex>=8||jogoFinalizado)return;tocarNota(nota);const notaEsperada=escalaCorreta[notaAtualIndex];const box=document.getElementById(`nota-box-${notaAtualIndex}`);if(nota===notaEsperada){box.textContent=nota;box.classList.add('nota-preenchida');acertosAcumulados[notaAtualIndex]++;notaAtualIndex++;checarVitoria();if(notaAtualIndex<8)atualizarFeedback(`Correto! Escolha a ${notaAtualIndex+1}¬™ nota. Erros acumulados: ${totalErros}`);}else{totalErros++;errosPorNota[notaAtualIndex]++;box.classList.add('nota-errada');atualizarFeedback(`Ops! Nota ${nota} errada. Erros acumulados: ${totalErros}`,'danger');setTimeout(()=>box.classList.remove('nota-errada'),700);}atualizarGraficoNotas();}
function checarVitoria(){if(notaAtualIndex===8){document.getElementById('botao-proximo').classList.remove('d-none');document.getElementById('botao-tocar-escala').classList.remove('d-none');document.querySelectorAll('.nota-teclado').forEach(btn=>btn.setAttribute('disabled','true'));desafiosCompletados++;document.getElementById('contador-desafios').textContent=desafiosCompletados;if(desafiosCompletados>=MAX_DESAFIOS)setTimeout(exibirRelatorioFinal,1000);atualizarGraficoAcumulado();}}
function proximoDesafio(){if(desafiosCompletados<MAX_DESAFIOS)gerarDesafio();else exibirRelatorioFinal();}
function exibirRelatorioFinal(){jogoFinalizado=true;document.getElementById('area-jogo').classList.add('d-none');document.getElementById('area-relatorio').classList.remove('d-none');document.getElementById('relatorio-detalhes').innerHTML=`Desafios completados: ${desafiosCompletados}<br>Erros totais: ${totalErros}`;}

// --- Gr√°ficos ---
let graficoNotas, graficoAcumulado;
function atualizarGraficoNotas(){if(!graficoNotas){const ctx=document.getElementById('grafico-notas').getContext('2d');graficoNotas=new Chart(ctx,{type:'bar',data:{labels:['1¬™','2¬™','3¬™','4¬™','5¬™','6¬™','7¬™','8¬™'],datasets:[{label:'Erros nesta escala',data:errosPorNota,backgroundColor:'rgba(220,53,69,0.7)'}]},options:{responsive:true,plugins:{legend:{display:true}}}});}else{graficoNotas.data.datasets[0].data=errosPorNota;graficoNotas.update();}}
function atualizarGraficoAcumulado(){if(!graficoAcumulado){const ctx=document.getElementById('grafico-acumulado').getContext('2d');graficoAcumulado=new Chart(ctx,{type:'bar',data:{labels:['1¬™','2¬™','3¬™','4¬™','5¬™','6¬™','7¬™','8¬™'],datasets:[{label:'Acertos acumulados',data:acertosAcumulados,backgroundColor:'rgba(40,167,69,0.7)'}]},options:{responsive:true,plugins:{legend:{display:true}}}});}else{graficoAcumulado.data.datasets[0].data=acertosAcumulados;graficoAcumulado.update();}}

// --- Inicializa√ß√£o ---
document.addEventListener('DOMContentLoaded',()=>{const modal=new bootstrap.Modal(document.getElementById('welcomeModal'));modal.show();});
</script>
</body>
</html>



